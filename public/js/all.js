$(document).ready(function(){function e(e,t,a){swal({title:t,text:a,type:"warning",showCancelButton:!0,cancelButtonText:"Annuler",confirmButtonColor:"#DD6B55",confirmButtonText:"Confirmer",closeOnConfirm:!1},function(t){t?$(e).submit():$(".addMember")[0]&&($(".addMember").find("option")[0].selected=!0)})}$(".button-delete").click(function(){event.preventDefault();var t=$(this).data("type"),a=$(this).data("name"),r="",n="",i=$(this).parent();switch(t){case"sport":r='Voulez-vous vraiment supprimer le sport "'+a+'"?',n="La suppression de ce sport va entrainer la suppression des courts liés";break;case"court":r='Voulez-vous vraiment supprimer le terrain "'+a+'"?';break;case"tournament":r='Voulez-vous vraiment supprimer le tournois "'+a+'" ?';break;case"teamMember":r='Voulez-vous vraiment supprimer "'+a+'" de cette équipe ?';break;case"memberTeam":r="Voulez-vous vraiment retirer "+a+" ?"}e(i,r,n)}),$(".addMember").change(function(){var t=$(this).find("option:selected").text(),a=$(this).parent();if("team"==$(this).attr("name"))var r="Voulez-vous ajouter ce participant à l'équipe \""+t+'" ?';else var r='Voulez-vous ajouter "'+t+"\" à l'équipe ?";e(a,r,"")})}),$(document).ready(function(){$(".show-devs").click(function(){$(".dev-names").hasClass("hide")?$(".dev-names").removeClass("hide").addClass("show"):$(".dev-names").removeClass("show").addClass("hide")})}),$(document).ready(function(){$(".formSend").click(function(){var e=$(this).parent().parent(),t=e.attr("id"),a="";switch(t){case"formSport":var r=$("#formSport #name").val(),n=$("#formSport #description").val(),i=/^[a-zA-Z0-9-_ ]{3,20}$/,o=/^[a-zA-Z0-9-_ ]{0,45}$/;i.test(r)||(a+="Le champ Nom ne doit pas être vide et doit avoir entre 3 et 45 caractères.<br>"),o.test(n)||(a+="Le champ Description peut avoir maximum 45 caractères.<br>");break;case"formCourt":var r=$("#formCourt #name").val(),s=$("#formCourt #acronym").val(),c=$("#formCourt #sport").val(),i=/^[a-zA-Z0-9-_ ]{1,20}$/,d=/^[a-zA-Z0-9-_ ]{3,3}$/,l=/^[0-9]+$/;i.test(r)||(a+="Le champ Nom ne doit pas être vide et doit avoir entre 1 et 20 caractères.<br>"),d.test(s)||(a+="Le champ Acronym ne doit pas être vide et doit avoir 3 caractères.<br>"),l.test(c)||(a+="Aucun sport sélectionné.<br>");break;case"formEvent":var r=$("#formEvent #name").val(),u=$("#formEvent #img").val(),i=/^[a-zA-Z0-9-_ ]{3,20}$/;i.test(r)||(a+="Le champ Nom ne doit pas être vide et doit avoir entre 3 et 20 caractères.<br>"),""==u&&$("#formEvent").is(".add")&&(a+="Le champ Image ne doit pas être vide.<br>");break;case"formTournament":var r=$("#formTournament #name").val(),c=$("#formTournament #sport").val(),m=$("#formTournament #startDate").val(),p=$("#formTournament #startTime").val(),u=$("#formTournament #img").val(),i=/^[a-zA-Z0-9-_ ]{3,45}$/,l=/^[0-9]+$/,v=/^[0-9]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1])$/,f=/^([01]\d|2[0-3]):([0-5]\d)$/;i.test(r)||(a+="Le champ Nom ne doit pas être vide et doit avoir entre 3 et 45 caractères.<br>"),l.test(c)||(a+="Aucun sport sélectionné.<br>"),f.test(p)||(a+="Le champ Heure de début ne doit pas être vide et doit être sous la forme hh:mm.<br>"),v.test(m)||(a+="Le champ Date de début ne doit pas être vide et doit être sous la forme jj.mm.aaaa.<br>"),""==u&&$("#formTournament").is(".add")&&(a+="Le champ Image ne doit pas être vide.<br>")}""==a?e.submit():($(".alert").remove(),$(".alert-danger").remove(),$("h1").after('<div class="alert alert-danger">'+a+"</div>"))})}),$(document).ready(function(){$("#login_link").click(function(){$("#login_popup").modal(),$("#login_popup .modal-body .error").remove()}),$("#login_popup").on("shown.bs.modal",function(){$("#username").focus()}),$("#login_popup .btn-login-form").click(function(e){e.preventDefault();var t=$("#login-form #username").val(),a=$("#login-form #password").val(),r=$("#login-form input[name=_token]").val();$.ajax({url:"/admin",method:"POST",dataType:"html",headers:{"X-CSRF-TOKEN":r},data:{username:t,password:a},success:function(e){var t=e.split("::");if("accepted"==t[0])window.location.href=t[1];else{var a=t[1];$("#login_popup .modal-body .error").remove(),$("#login_popup .modal-body").append('<div class="error">'+a+"</div>"),$("#login-form #password").val("")}}})})}),$(document).ready(function(){$("#multiple-teams-select").length&&$("#multiple-teams-select").select2({placeholder:"Choisir une équipe",allowClear:!0})}),$(document).ready(function(){$(".search").on("input",function(e){var t=$(".search").val().toLowerCase();$(".searchIn tr, .searchIn .hideSearch").each(function(){var e=$(this).find(".name").text().toLowerCase();e.indexOf(t)<0?$(this).hide("fast"):$(this).show("fast")})});var e={language:{decimal:"",emptyTable:"Aucune données disponible",info:"_START_ à _END_ sur _TOTAL_ entrées",infoEmpty:"0 à 0 sur 0 entrées",infoFiltered:"(Total de _MAX_ total entrées)",infoPostFix:"",thousands:",",lengthMenu:"Voir _MENU_ entrée",loadingRecords:"Chargement...",processing:"En traitement...",search:"",searchPlaceholder:"Recherche",zeroRecords:"Aucune données trouvées",paginate:{first:"Première",last:"Dernière",next:"Suivant",previous:"Précédent"}},paging:!1,info:!1,searching:!1},t={language:{decimal:"",emptyTable:"Aucune données disponible",info:"_START_ à _END_ sur _TOTAL_ entrées",infoEmpty:"0 à 0 sur 0 entrées",infoFiltered:"(Total de _MAX_ total entrées)",infoPostFix:"",thousands:",",lengthMenu:"Voir _MENU_ entrée",loadingRecords:"Chargement...",processing:"En traitement...",search:"",searchPlaceholder:"Recherche",zeroRecords:"Aucune données trouvées",paginate:{first:"Première",last:"Dernière",next:"Suivant",previous:"Précédent"}},bLengthChange:!1};$("#tournament-teams-table").DataTable(t),$("#teams-table").DataTable(t),$("#participants-table").DataTable(t),$(".translate").DataTable(e),$(".dataTables_wrapper").removeClass("container-fluid"),$("#pools-table tr td.clickable").click(function(){var e=$("#pools-table").data("tournament"),t=$(this).data("id");window.location.href=e+"/pools/"+t}),$("#teams-table tr td.clickable").click(function(){var e=$(this).data("id");window.location.href="teams/"+e}),$("#teams-show-table tr td.clickable").click(function(){var e=$(this).data("id");window.location.href="/admin/participants/"+e}),$("#participants-table tr td.clickable").click(function(){var e=$(this).data("id");window.location.href="participants/"+e}),$("#participants-show-table tr td.clickable").click(function(){var e=$(this).data("id");window.location.href="/admin/teams/"+e}),$("#tournament-teams-table tr td.clickable").click(function(){var e=$(this).data("id");window.location.href="/admin/teams/"+e})}),$(document).ready(function(){$(".big-screen").click(function(e){e.preventDefault(),window.open($(this).attr("href"),"_blank","height="+screen.height+",width="+screen.width)})}),$(document).ready(function(){$(".return").each(function(){$(this).click(function(e){e.preventDefault(),history.back()})})}),$(document).ready(function(){function e(r){var i=r.parent(),o=i.parent().children("td.score1"),s=i.parent().children("td.score2"),c=o.text(),d=s.text();o.empty(),s.empty();var l=document.createElement("input");l.setAttribute("type","number"),l.setAttribute("min","0"),l.setAttribute("value",c);var u=document.createElement("input");u.setAttribute("type","number"),u.setAttribute("min","0"),u.setAttribute("value",d),o.append(l),s.append(u);var m=document.createElement("i");m.className+="fa fa-lg fa-check-square-o",m.setAttribute("aria-hidden","true");var p=document.createElement("i");p.className+="fa fa-lg fa-times",p.setAttribute("aria-hidden","true"),r.after(m),m.after(p),r.remove(),$(p).click(function(){i.append(r),m.remove(),p.remove(),l.remove(),u.remove(),o.append(c),s.append(d),r.click(function(){e($(this))})}),$(m).click(function(){a($(l).val(),$(u).val())?n(i):t("danger","Format de score invalide")})}function t(e,t){switch($(".alert").remove(),e){case"danger":var a=$("<div class='alert alert-danger' role='alert'>"+t+"</div>");$("#match-block").prepend(a),r(a);break;case"success":var n=$("<div class='alert alert-success' role='alert'>"+t+"</div>");$("#match-block").prepend(n),r(n)}}function a(e,t){var a=/^[0-9]{1,3}$/;return!(!a.test(e)||!a.test(t))}function r(e){e.fadeTo(3e3,500).slideUp(500,function(){e.slideUp(500)})}function n(a){var r=$("table#matches").data("tournament"),n=$("table#matches").data("pool"),o=a.parent().data("game"),s=document.createElement("div");s.id+="opac";var c=document.createElement("img");c.className+="loader",c.src="/images/loader.gif",s.prepend(c),document.body.prepend(s),$.ajax({url:"/admin/tournaments/"+r+"/pools/"+n+"/games/"+o,method:"PUT",dataType:"json",cache:!1,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},data:{score1:a.parent().children("td.score1").children("input").val(),score2:a.parent().children("td.score2").children("input").val()},error:function(e,a,r){200!=e.status&&t("danger","Une erreur est survenue ..."),s.remove()},success:function(r){var n=document.createElement("i");n.className+="fa fa-lg fa-pencil",n.setAttribute("aria-hidden","true");var o=a.parent().children("td.score1"),c=a.parent().children("td.score2"),n=$(n),d=a.children("i.fa-check-square-o"),l=a.children("i.fa-times");a.append(n),d.remove(),l.remove(),o.append(o.children("input").val()),c.append(c.children("input").val()),o.children("input").remove(),c.children("input").remove(),n.click(function(){e($(this))}),i(r),t("success","Changement effectué et classement mis à jour"),s.remove()}})}function i(e){var t=$("#pool-rankings-table tbody");t.empty();for(var a=0;a<e.length;a++)tr=document.createElement("tr"),allTds="<td>"+(a+1)+"</td><td>"+e[a].team+"</td><td>"+e[a].score+"</td><td>"+e[a].W+"</td><td>"+e[a].L+"</td><td>"+e[a].D+"</td><td>"+e[a]["+-"]+"</td>",tr.innerHTML=allTds,t.append(tr)}$("table#matches td.action i.editScore").click(function(){e($(this))})}),$(document).ready(function(){function e(e){var a=$("#shiftTime").val();if(a%1!==0||""==a)return void t("danger","Le décalage doit être un numéro entier qui correspond a un temps en minute...");var r=$("#matches tr .separator"),n=$("table#matches").data("tournament"),i=$("table#matches").data("pool");r.each(function(){var e=$(this).parent().data("game"),r=$(this).text(),o=r.split(":"),s=60*o[0]*60+60*o[1];s+=60*a;var c=new Date(null);c.setTime(c.getTime()+60*c.getTimezoneOffset()*1e3),c.setSeconds(s);var d=(c.toISOString().substr(11,8),("0"+c.getHours()).slice(-2)+":"+("0"+c.getMinutes()).slice(-2)),l=("0"+c.getHours()).slice(-2)+":"+("0"+c.getMinutes()).slice(-2)+":"+("0"+c.getSeconds()).slice(-2);$.ajax({url:"/admin/tournaments/"+n+"/pools/"+i+"/games/"+e,method:"PUT",context:this,cache:!1,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},data:{newTime:l,newTime:l},error:function(e,a,r){200!=e.status&&t("danger","Une erreur est survenue ...")},success:function(e){$(this).text(d)}})})}function t(e,t){switch($(".alert").remove(),e){case"danger":var a=$("<div class='alert alert-danger' role='alert'>"+t+"</div>");$("#match-block").prepend(a),disappear(a);break;case"success":var r=$("<div class='alert alert-success' role='alert'>"+t+"</div>");$("#match-block").prepend(r),disappear(r)}}function a(e){var r=e.parent(),n=r.parent().children("td.separator"),i=n.text().split(":")[0],o=n.text().split(":")[1],s='<input type="text" id="formMinuteTime" value="'+i+'">:<input type="text" id="formMinuteTime" value="'+o+'">';n.text(""),n.append(s);var c=document.createElement("i");c.className+="fa fa-lg fa-check-square-o",c.setAttribute("aria-hidden","true");var d=document.createElement("i");d.className+="fa fa-lg fa-times",d.setAttribute("aria-hidden","true"),e.after(c),c.after(d),e.remove(),$(d).click(function(){n.text(i+":"+o),r.append(e),c.remove(),d.remove(),e.click(function(){a($(this))})}),$(c).click(function(){var e=$("#formMinuteTime").val(),a=$("#formMinuteTime").val(),r=!0;!(e>0&&e<60&&a>0&&a<24)||a%1===0&&""!=a||e%1===0&&""!=e||(r=!1),r?alert(e):t("danger","Format de temps invalide")})}$("#shiftMatch").click(function(){event.preventDefault(),e($(this))}),$("table#matches td.action i.editTime").click(function(){a($(this))})}),$(document).ready(function(){$(".import").click(function(){$(this).parent().submit()})});