function closePool(){$(".close-pool-btn").click(function(){alertConfirmEndPool("Terminer la poule","Etes-vous sur de vouloir terminer la poule, le changement de score sera impossible après cette action !")})}function alertConfirmEndPool(e,t){swal({title:e,text:t,type:"warning",showCancelButton:!0,cancelButtonText:"Annuler",confirmButtonColor:"#DD6B55",confirmButtonText:"Confirmer"},function(e){if(e){var t=document.createElement("div");t.id+="opac";var a=document.createElement("img");a.className+="loader",a.src="/images/loader.gif",t.prepend(a),document.body.prepend(t);var r=$("table#matches").data("tournament"),n=$("table#matches").data("pool");$("#pool-rankings-table tbody tr").each(function(){$.ajax({url:"/admin/tournaments/"+r+"/pools/"+n,method:"PUT",dataType:"json",cache:!1,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},data:{team_id:$(this).data("id"),rank_in_pool:$(this).data("rank")},success:function(e){if(!$(".alert.alert-success.end-pool").length){var a=$("<div class='alert alert-success end-pool' role='alert'>Le poule à bien été terminée</div>");$("#match-block").prepend(a),a.fadeTo(3e3,500).slideUp(500,function(){a.slideUp(500)})}$(".action i").each(function(){$(this).remove()}),$(".close-pool-btn").remove(),$("input#shiftTime").parent().remove(),t.remove()},error:function(e){t.remove()}})})}})}$(document).ready(function(){function e(e,t,a){swal({title:t,text:a,type:"warning",showCancelButton:!0,cancelButtonText:"Annuler",confirmButtonColor:"#DD6B55",confirmButtonText:"Confirmer",closeOnConfirm:!1},function(t){t?$(e).submit():$(".addMember")[0]&&($(".addMember").find("option")[0].selected=!0)})}$(".button-delete").click(function(){event.preventDefault();var t=$(this).data("type"),a=$(this).data("name"),r="",n="",o=$(this).parent();switch(t){case"sport":r='Voulez-vous vraiment supprimer le sport "'+a+'"?',n="La suppression de ce sport va entrainer la suppression des courts liés";break;case"court":r='Voulez-vous vraiment supprimer le terrain "'+a+'"?';break;case"tournament":r='Voulez-vous vraiment supprimer le tournois "'+a+'" ?';break;case"teamMember":r='Voulez-vous vraiment supprimer "'+a+'" de cette équipe ?';break;case"memberTeam":r="Voulez-vous vraiment retirer "+a+" ?"}e(o,r,n)}),$(".addMember").change(function(){var t=$(this).find("option:selected").text(),a=$(this).parent();if("team"==$(this).attr("name"))var r="Voulez-vous ajouter ce participant à l'équipe \""+t+'" ?';else var r='Voulez-vous ajouter "'+t+"\" à l'équipe ?";e(a,r,"")})}),$(document).ready(function(){$(".show-devs").click(function(){$(".dev-names").hasClass("hide")?$(".dev-names").removeClass("hide").addClass("show"):$(".dev-names").removeClass("show").addClass("hide")})}),$(document).ready(function(){$(".formSend").click(function(){var e=$(this).parent().parent(),t=e.attr("id"),a="";switch(t){case"formSport":var r=$("#formSport #name").val(),n=$("#formSport #description").val(),o=/^[a-zA-Z0-9-_ ]{3,20}$/,i=/^[a-zA-Z0-9-_ ]{0,45}$/;o.test(r)||(a+="Le champ Nom ne doit pas être vide et doit avoir entre 3 et 45 caractères.<br>"),i.test(n)||(a+="Le champ Description peut avoir maximum 45 caractères.<br>");break;case"formCourt":var r=$("#formCourt #name").val(),c=$("#formCourt #acronym").val(),s=$("#formCourt #sport").val(),o=/^[a-zA-Z0-9-_ ]{1,20}$/,d=/^[a-zA-Z0-9-_ ]{1,3}$/,l=/^[0-9]+$/;o.test(r)||(a+="Le champ Nom ne doit pas être vide et doit avoir entre 1 et 20 caractères.<br>"),d.test(c)||(a+="Le champ Acronyme ne doit pas être vide et doit avoir entre 1 et 3 caractères.<br>"),l.test(s)||(a+="Aucun sport sélectionné.<br>");break;case"formEvent":var r=$("#formEvent #name").val(),m=$("#formEvent #img").val(),o=/^[a-zA-Z0-9-_ ]{3,20}$/;o.test(r)||(a+="Le champ Nom ne doit pas être vide et doit avoir entre 3 et 20 caractères.<br>"),""==m&&$("#formEvent").is(".add")&&(a+="Le champ Image ne doit pas être vide.<br>");break;case"formTournament":var r=$("#formTournament #name").val(),s=$("#formTournament #sport").val(),u=$("#formTournament #startDate").val(),p=$("#formTournament #startTime").val(),m=$("#formTournament #img").val(),o=/^[a-zA-Z0-9-_ ]{3,45}$/,l=/^[0-9]+$/,h=/^[0-9]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1])$/,v=/^([01]\d|2[0-3]):([0-5]\d)$/;o.test(r)||(a+="Le champ Nom ne doit pas être vide et doit avoir entre 3 et 45 caractères.<br>"),l.test(s)||(a+="Aucun sport sélectionné.<br>"),v.test(p)||(a+="Le champ Heure de début ne doit pas être vide et doit être sous la forme hh:mm.<br>"),h.test(u)||(a+="Le champ Date de début ne doit pas être vide et doit être sous la forme jj.mm.aaaa.<br>"),""==m&&$("#formTournament").is(".add")&&(a+="Le champ Image ne doit pas être vide.<br>")}""==a?e.submit():($(".alert").remove(),$(".alert-danger").remove(),$("h1").after('<div class="alert alert-danger">'+a+"</div>"))})}),$(document).ready(function(){$("#login_link").click(function(){$("#login_popup").modal(),$("#login_popup .modal-body .error").remove()}),$("#login_popup").on("shown.bs.modal",function(){$("#username").focus()}),$("#login_popup .btn-login-form").click(function(e){e.preventDefault();var t=$("#login-form #username").val(),a=$("#login-form #password").val(),r=$("#login-form input[name=_token]").val();$.ajax({url:"/admin",method:"POST",dataType:"html",headers:{"X-CSRF-TOKEN":r},data:{username:t,password:a},success:function(e){var t=e.split("::");if("accepted"==t[0])window.location.href=t[1];else{var a=t[1];$("#login_popup .modal-body .error").remove(),$("#login_popup .modal-body").append('<div class="error">'+a+"</div>"),$("#login-form #password").val("")}}})})}),$(document).ready(function(){$("#multiple-teams-select").length&&$("#multiple-teams-select").select2({placeholder:"Choisir une équipe",allowClear:!0})}),$(document).ready(function(){$(".search").on("input",function(e){var t=$(".search").val().toLowerCase();$(".searchIn tr, .searchIn .hideSearch").each(function(){var e=$(this).find(".name").text().toLowerCase();e.indexOf(t)<0?$(this).hide("fast"):$(this).show("fast")})});var e={language:{decimal:"",emptyTable:"Aucune données disponible",info:"_START_ à _END_ sur _TOTAL_ entrées",infoEmpty:"0 à 0 sur 0 entrées",infoFiltered:"(Total de _MAX_ total entrées)",infoPostFix:"",thousands:",",lengthMenu:"Voir _MENU_ entrée",loadingRecords:"Chargement...",processing:"En traitement...",search:"",searchPlaceholder:"Recherche",zeroRecords:"Aucune données trouvées",paginate:{first:"Première",last:"Dernière",next:"Suivant",previous:"Précédent"}},paging:!1,info:!1,searching:!1},t={language:{decimal:"",emptyTable:"Aucune données disponible",info:"_START_ à _END_ sur _TOTAL_ entrées",infoEmpty:"0 à 0 sur 0 entrées",infoFiltered:"(Total de _MAX_ total entrées)",infoPostFix:"",thousands:",",lengthMenu:"Voir _MENU_ entrée",loadingRecords:"Chargement...",processing:"En traitement...",search:"",searchPlaceholder:"Recherche",zeroRecords:"Aucune données trouvées",paginate:{first:"Première",last:"Dernière",next:"Suivant",previous:"Précédent"}},bLengthChange:!1};$("#tournament-teams-table").DataTable(t),$("#teams-table").DataTable(t),$("#participants-table").DataTable(t),$(".translate").DataTable(e),$(".dataTables_wrapper").removeClass("container-fluid"),$("#pools-table td.clickable").on("click",function(){var e=$("#pools-table").data("tournament"),t=$(this).data("id");window.location.href=e+"/pools/"+t}),$("#teams-table").on("click","td.clickable",function(){var e=$(this).data("id");window.location.href="teams/"+e}),$("#teams-show-table").on("click","td.clickable",function(){var e=$(this).data("id");window.location.href="/admin/participants/"+e}),$("#participants-table").on("click","td.clickable",function(){var e=$(this).data("id");window.location.href="participants/"+e}),$("#participants-show-table").on("click","td.clickable",function(){var e=$(this).data("id");window.location.href="/admin/teams/"+e}),$("#tournament-teams-table").on("click","td.clickable",function(){var e=$(this).data("id");window.location.href="/admin/teams/"+e})}),$(document).ready(function(){$(".big-screen").click(function(e){e.preventDefault(),window.open($(this).attr("href"),"_blank","height="+screen.height+",width="+screen.width)})}),$(document).ready(function(){$(".return").each(function(){$(this).click(function(e){e.preventDefault(),history.back()})})}),$(document).ready(function(){function e(r){r.parent().children(".editTime").hide();var o=r.parent(),i=o.parent().children("td.score1"),c=o.parent().children("td.score2"),s=i.text(),d=c.text();i.empty(),c.empty();var l=document.createElement("input");l.setAttribute("type","number"),l.setAttribute("min","0"),l.setAttribute("value",s);var m=document.createElement("input");m.setAttribute("type","number"),m.setAttribute("min","0"),m.setAttribute("value",d),i.append(l),c.append(m);var u=document.createElement("i");u.className+="fa fa-lg fa-check-square-o",u.setAttribute("aria-hidden","true");var p=document.createElement("i");p.className+="fa fa-lg fa-times",p.setAttribute("aria-hidden","true"),r.after(u),u.after(p),r.remove(),$(p).click(function(){$(this).parent().children(".editTime").show(),o.append(r),u.remove(),p.remove(),l.remove(),m.remove(),i.append(s),c.append(d),r.click(function(){e($(this))})}),$(u).click(function(){a($(l).val(),$(m).val())?n(o):t("danger","Format de score invalide")})}function t(e,t){switch($(".alert").remove(),e){case"danger":var a=$("<div class='alert alert-danger' role='alert'>"+t+"</div>");$("#match-block").prepend(a),r(a);break;case"success":var n=$("<div class='alert alert-success' role='alert'>"+t+"</div>");$("#match-block").prepend(n),r(n)}}function a(e,t){var a=/^[0-9]{1,3}$/;return!(!a.test(e)||!a.test(t))}function r(e){e.fadeTo(3e3,500).slideUp(500,function(){e.slideUp(500)})}function n(a){var r=$("table#matches").data("tournament"),n=$("table#matches").data("pool"),i=a.parent().data("game"),c=document.createElement("div");c.id+="opac";var s=document.createElement("img");s.className+="loader",s.src="/images/loader.gif",c.prepend(s),document.body.prepend(c),$.ajax({url:"/admin/tournaments/"+r+"/pools/"+n+"/games/"+i,method:"PUT",dataType:"json",context:this,cache:!1,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},data:{score1:a.parent().children("td.score1").children("input").val(),score2:a.parent().children("td.score2").children("input").val()},error:function(e,a,r){200!=e.status&&t("danger","Une erreur est survenue ..."),c.remove()},success:function(r){var n=document.createElement("i");n.className+="fa fa-lg fa-trophy",n.setAttribute("aria-hidden","true");var i=a.parent().children("td.score1"),s=a.parent().children("td.score2"),n=$(n),d=a.children("i.fa-check-square-o"),l=a.children("i.fa-times");d.parent().parent().children(".separator").text("-"),d.parent().parent().children(".separator").removeClass("sepTime"),d.parent().children(".editTime").remove(),a.append(n),d.remove(),l.remove(),i.append(i.children("input").val()),s.append(s.children("input").val()),i.children("input").remove(),s.children("input").remove(),n.click(function(){e($(this))}),0==$(".sepTime").length&&0==$(".close-pool-btn").length&&($("h1").append('<a class="greenBtn close-pool-btn">Terminer la poule</a>'),closePool()),o(r),t("success","Changement effectué et classement mis à jour"),c.remove()}})}function o(e){var t=$("#pool-rankings-table tbody");t.empty();for(var a=0;a<e.length;a++)tr=$('<tr data-id="'+e[a].team_id+'" data-rank="'+(a+1)+'"></tr>'),allTds="<td>"+(a+1)+"</td><td>"+e[a].team+"</td><td>"+e[a].score+"</td><td>"+e[a].W+"</td><td>"+e[a].L+"</td><td>"+e[a].D+"</td><td>"+e[a]["+-"]+"</td>",tr.html(allTds),t.append(tr)}$("table#matches td.action i.editScore").click(function(){e($(this))})}),$(document).ready(function(){function e(e){var a=$("#shiftTime").val();if(a%1!==0||""==a)return t("danger","Le décalage doit être un numéro entier qui correspond à un temps en minute..."),void opac.remove();var r=$("#matches tr .sepTime"),n=$("table#matches").data("tournament"),o=$("table#matches").data("pool");r.each(function(){var e=$(this).parent().data("game"),r=$(this).text(),i=r.split(":"),c=60*i[0]*60+60*i[1];c+=60*a;var s=new Date(null);s.setTime(s.getTime()+60*s.getTimezoneOffset()*1e3),s.setSeconds(c);var d=(s.toISOString().substr(11,8),("0"+s.getHours()).slice(-2)+":"+("0"+s.getMinutes()).slice(-2)),l=("0"+s.getHours()).slice(-2)+":"+("0"+s.getMinutes()).slice(-2)+":"+("0"+s.getSeconds()).slice(-2);$.ajax({url:"/admin/tournaments/"+n+"/pools/"+o+"/games/"+e,method:"PUT",context:this,cache:!1,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},data:{newTime:l},error:function(e,a,r){200!=e.status&&(t("danger","Une erreur est survenue ..."),opac.remove())},success:function(e){$(this).text(d),$(".alert.alert-success").length||t("success","Le décalage des heures a bien été effectué"),$("#opac").length&&opac.remove()}})})}function t(e,t){switch($(".alert").remove(),e){case"danger":var r=$("<div class='alert alert-danger' role='alert'>"+t+"</div>");$("#match-block").prepend(r),a(r);break;case"success":var n=$("<div class='alert alert-success' role='alert'>"+t+"</div>");$("#match-block").prepend(n),a(n)}}function a(e){e.fadeTo(3e3,500).slideUp(500,function(){e.slideUp(500)})}function r(e){e.parent().children(".editScore").hide();var a=e.parent(),n=a.parent().children("td.separator"),o=n.text().split(":")[0],i=n.text().split(":")[1],c='<input type="text" id="formHourTime" value="'+o+'">:<input type="text" id="formMinuteTime" value="'+i+'">';n.text(""),n.append(c);var s=document.createElement("i");s.className+="fa fa-lg fa-check-square-o",s.setAttribute("aria-hidden","true");var d=document.createElement("i");d.className+="fa fa-lg fa-times",d.setAttribute("aria-hidden","true"),e.after(s),s.after(d),e.remove(),$(d).click(function(){$(this).parent().children(".editScore").show(),n.text(o+":"+i),a.prepend(e),s.remove(),d.remove(),e.click(function(){r($(this))})}),$(s).click(function(){var n=document.createElement("div");n.id+="opac";var o=document.createElement("img");o.className+="loader",o.src="/images/loader.gif",n.prepend(o),document.body.prepend(n);var i=$("#formMinuteTime").val(),c=$("#formHourTime").val();if(i>=60||i<0||i%1!==0||""==i)return void t("danger","Format de temps invalide");if(c>=24||c<0||c%1!==0||""==c)return void t("danger","Format de temps invalide");var l=$("table#matches").data("tournament"),m=$("table#matches").data("pool"),u=$(this).parent().parent().data("game"),p=c+":"+i+":00";$.ajax({url:"/admin/tournaments/"+l+"/pools/"+m+"/games/"+u,method:"PUT",context:this,cache:!1,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},data:{newTime:p},error:function(e,a,r){200!=e.status&&t("danger","Une erreur est survenue ..."),n.remove()},success:function(o){$(this).parent().children(".editScore").show(),1==i.length&&(i="0"+i),1==c.length&&(c="0"+c),$(this).parent().parent().children(".separator").text(c+":"+i),a.prepend(e),s.remove(),d.remove(),e.click(function(){r($(this))}),t("success","Changement d'heure effectué"),n.remove()}})})}$("#shiftMatch").click(function(){var t=document.createElement("div");t.id+="opac";var a=document.createElement("img");a.className+="loader",a.src="/images/loader.gif",t.prepend(a),document.body.prepend(t),event.preventDefault(),e($(this))}),$("table#matches td.action i.editTime").click(function(){r($(this))})}),$(document).ready(function(){$(".import").click(function(){$(this).parent().submit()})}),$(document).ready(function(){closePool()});